{% load django_bootstrap5 wjs_review %}
{% url "wjs_select_reviewer" workflow.pk as wjs_select_reviewer %}
{% for user in users %}
  {% url "wjs_invite_reviewer_prophy" workflow.pk user.author_id as invite_reviewer_prophy %}
  {% url "wjs_editor_assigns_themselves_as_reviewer" workflow.pk as editor_assigns_themselves %}
  {% reviewer_btn_props user selected workflow as btn %}
  <tr>
    <td>
      {% if user.wjs_is_only_prophy %}
        <a href="{{ user.wjs_prophy_auth_url }}{{ user.author_id }}" title="{% translate "Candidate's details on Prophy" %}" target="_blank">{{ user.full_name }}</a>
      {% else %}
        {{ user.full_name }}
      {% endif %}
    </td>
    <td>{{ user.email }}</td>
    <td>
      {% if user.wjs_is_author %}{% translate "Author of this preprint" %}{% endif %}
      {# TODO: user.is_active to be replaced by user.does_not_want_to_review_anything #}
      {% if not user.is_active %}{% translate "Unavailable as reviewer" %}{% endif %}
      {% if user.wjs_is_active_reviewer %}
        {% if user.wjs_has_declined_current_review_round %}
          {% translate "Declined/removed from current version" %}
        {% elif user.wjs_has_currently_completed_review %}
          {% translate "Review already available" %}
        {% else %}
          {% translate "Already selected" %}
        {% endif %}
      {% else %}
        {# Show flags for previous rounds only if there is nothing for the current one. #}
        {% if user.wjs_is_last_round_reviewer %}
          {% if user.wjs_has_delined_the_previous_review_round %}
            {% translate "Declined/removed from previous version" %}
          {% elif user.wjs_has_completed_review_in_the_previous_round %}
            {% translate "Reviewed previous version" %}
          {% else %}
            {% translate "Did not send requested review (previous version)" %}
          {% endif %}
        {% endif %}
      {% endif %}
      {% if user.wjs_is_prophy_candidate %}{% translate "Suggested by Prophy" %}{% endif %}
    </td>
    <td class="text-center">
      <!-- djlint:off -->
      {% translate "Invite new <i class=\"bi bi-person-plus-fill\"></i>" as invite_label %}
      <!-- djlint:on -->
      {% translate "Select" as select_label %}
      {% comment %} Tooltips for .disabled or disabled elements must be triggered on a wrapper element. {% endcomment %}
      {% if user.wjs_is_only_prophy %}
        {% bootstrap_button name="invite-reviewer" data_bs_toggle="modal" data_bs_target="#htmxModal" hx_trigger="click" hx_vals=btn.value hx_get=invite_reviewer_prophy hx_target="#htmxModalContent" content=invite_label %}
      {% elif workflow|is_user_article_editor:user  %}
        {% bootstrap_button name="editor-assign-themselves" data_bs_toggle="modal" data_bs_target="#htmxModal" hx_trigger="click" hx_vals=btn.value hx_get=editor_assigns_themselves hx_target="#htmxModalContent" content=select_label %}
      {% else %}
        <div class="d-inline-block" tabindex="0" data-toggle="tooltip" title="{{ btn.disabled_cause }}">

          {% bootstrap_button name="assign-reviewer" disabled=btn.disabled data_bs_toggle="modal" data_bs_target="#htmxModal" button_class=btn.css_class hx_vals=btn.value hx_trigger="click" hx_post=wjs_select_reviewer hx_target="#htmxModalContent" data_toggle=btn.disabled_cause content=select_label %}
        </div>
      {% endif %}
    </td>
  </tr>
{% empty %}
    <tr>
       No user found
    </tr>
{% endfor %}
