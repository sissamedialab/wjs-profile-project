{% load wjs_articles wjs_review wjs_tags %}
{% get_article_classes workflow as article_classes %}
{% with article=workflow.article attention_flag=workflow|article_requires_attention_tt:user %}
  <tr {% if attention_flag %}class="table-warning"{% endif %}>
    <td data-order="{% if view.table_configuration_options.table_type == "review" %}{{ article.date_submitted|date:"U" }}{% elif view.table_configuration_options.table_type == "production" %}{{ article.date_accepted|date:"U" }}{% endif %}" class="text-nowrap">
      <span class="badge {{ article_classes.section }}">{{ article.section.name }}</span>
      <a title="{{ article.title }}"
         href="{% url 'wjs_article_details' workflow.id %}"
         class="fw-bold">{{ article|versioned_number }}</a>
      <br />
      {% with preprintid=article|preprintid %}
        {% if preprintid %}
          {{ preprintid }}
          <br />
        {% endif %}
      {% endwith %}
      {% if view.table_configuration_options.table_type == "review" %}
        <span title="Submitted on {{ article.date_submitted }}">{{ article.date_submitted|date:"d-M" }}</span>
      {% elif view.table_configuration_options.table_type == "production" %}
        <span title="Accepted on {{ article.date_accepted }}">{{ article.date_accepted|date:"d-M" }}</span>
      {% endif %}
      <br />
      {{ article.articleworkflow.eo_in_charge|default:"—" }}
      <br />
      {{ article.primary_issue|default:"—" }}
    </td>
    <td class="{% if attention_flag %}fw-bolder{% endif %}">
      {% include "wjs_review/lists/elements/corresponding_author.html" %}
    </td>
    <td class="{% if attention_flag %}fw-bolder{% endif %}">
      {{ article.title|truncatewords:6 }}
    </td>
    <td class="position-relative {% if attention_flag %}fw-bolder align-bottom{% endif %}">
      {% include "wjs_review/lists/elements/table_item_status.html" with show_details=True %}
    </td>
    {% if view.table_configuration_options.table_type == "production" %}
      <td>
        {{ article|article_current_typesetter }}
      </td>
    {% elif view.table_configuration_options.table_type == "review" %}
      <td>
        {% with editor_assignment_data=article|article_current_editor %}
          {{ editor_assignment_data.editor }}
          {% if not view.table_configuration_options.hide_editor_age and workflow.get_state_display == "Editor selected" %}
            <div title="assigned">{{ editor_assignment_data.days_elapsed }} {% translate "days" %}</div>
          {% endif %}
        {% endwith %}
      </td>
      <td>
        {% if workflow.get_state_display == "Editor selected" %}
          {% include "wjs_review/lists/elements/table_item_reviewer.html" %}
        {% endif %}
      </td>
    {% endif %}
    <td title="latest EO note">
      {% last_eo_note target=workflow.article as note %}
      {% if note %}
        <button type="button" class="btn" data-bs-toggle="modal" data-bs-target="#note_modal">{{ note.body|truncatechars_html:7|striptags }} <i class="bi bi-card-text"></i></button>
        {% include "wjs_review/base/elements/modal.html" with modal_id="note_modal" modal_title="Notes" modal_body_title=note.subject modal_body=note.body %}
      {% endif %}
    </td>
  </tr>
{% endwith %}
