{% load django_bootstrap5 static %}
{% load wjs_tags %}
{% translate "Comments to the Editor" as comments_editor_title %}
{% translate "Cover letter" as cover_letter_file_label %}
{% translate "Author's note" as author_note_title %}
{% if assignment.workflowreviewassignment.author_note_visible %}
  {% with previous_revision=assignment.workflowreviewassignment.previous_review_round.editorrevisionrequest %}
      {% if previous_revision %}
        <div class="title-area mb-3 py-2">
          <strong>{% translate "Author's note" %}</strong>
        </div>
        {% if previous_revision.author_note_file %}
          {% bootstrap_button href=previous_revision.author_note_file.url content=cover_letter_file_label button_class="btn-outline-primary" %}
        {% endif %}
        {% if previous_revision.author_note %}
          {% with modal_id="author_note_modal" modal_target="#author_note_modal" modal_content=previous_revision.author_note %}
            <!-- djlint:off -->
            {% with author_note_label="<i class=\"bi bi-filetype-txt\"></i> "|concat:author_note_title %}
            <!-- djlint:on -->
              {% bootstrap_button content=author_note_label|safe button_class="btn-outline-primary" data_bs_toggle="modal" data_bs_target=modal_target %}
              {% include "wjs_review/base/elements/modal.html" with modal_id=modal_id modal_title=author_note_title modal_body=modal_content|safe %}
            {% endwith %}
          {% endwith %}
            {# FIXME: Content is not really safe, we must add a sanitizer (see https://pypi.org/project/html-sanitizer/) #}
        {% endif %}
      {% else %}
        {% with modal_id="comments_editor_modal" modal_target="#comments_editor_modal" modal_content=assignment.article.comments_editor %}
          <!-- djlint:off -->
          {% with comments_editor_label="<i class=\"bi bi-filetype-txt\"></i> "|concat:comments_editor_title %}
          <!-- djlint:on -->
            {% bootstrap_button content=comments_editor_label|safe button_class="btn-outline-primary" data_bs_toggle="modal" data_bs_target=modal_target %}
            {% include "wjs_review/base/elements/modal.html" with modal_id=modal_id modal_title=comments_editor_title modal_body=modal_content|safe %}
          {% endwith %}
        {% endwith %}
      {% endif %}
  {% endwith %}
{% endif %}
