{% load i18n wjs_review %}
<div class="card border border-1">
    {% with assignment=assignment_and_actions.assignment %}
        {% with attention_flag=assignment|assignment_requires_attention_tt %}
            <div class="card-body">
                {% if attention_flag %}<p class="text-warning">{{ attention_flag }}</p>{% endif %}
                <p>
                    Assignment {{ assignment.id }} to
                    {% if assignment.date_accepted and assignment.is_complete %}
                        <a href="{% url "wjs_review_end" assignment_id=assignment.pk %}?access_code={{ assignment.access_code }}">{{ assignment.reviewer }}</a>
                    {% elif assignment.date_accepted %}
                        <a href="{% url "wjs_review_review" assignment_id=assignment.pk %}?access_code={{ assignment.access_code }}">{{ assignment.reviewer }}</a>
                    {% elif assignment.date_declined %}
                        <a href="{% url "wjs_declined_review" assignment_id=assignment.pk %}?access_code={{ assignment.access_code }}">{{ assignment.reviewer }}</a>
                    {% else %}
                        <a href="{% url "wjs_evaluate_review" assignment_id=assignment.pk %}?access_code={{ assignment.access_code }}">{{ assignment.reviewer }}</a>
                        {% endif %}
                        <a href="{% url "wjs_article_messages" article_id=assignment.article.id recipient_id=assignment.reviewer.id %}" title="Click to contact / communicate">ðŸ“§</a>{# TODO: add id of reviewer #}
                    (requested {{ assignment.date_requested }}) for review round {{ assignment.review_round.round_number }}.
                </p>
                <p>
                    Due
                    {{ assignment.date_due }} and
                    {% if assignment.date_accepted %}
                        {% if assignment.is_complete %}
                            accepted
                        {% else %}
                            <span class="text-warning">accepted</span>
                        {% endif %}
                        {{ assignment.date_accepted }}
                    {% elif assignment.date_declined %}
                        <span class="text-muted">declined</span> {{ assignment.date_declined }}
                    {% else %}
                        <span class="text-warning">waiting for anwer.</span>
                    {% endif %}
                </p>
                {% if assignment.date_reminded %}
                    <p>
                        Last reminder sent on
                        {{ assignment.date_reminded }}
                    </p>
                {% endif %}
                {% if assignment.date_accepted and assignment.is_complete %}
                    <p>
                        <span class="text-success">Completed on</span>
                        {{ assignment.date_complete }}.
                    </p>
                {% endif %}
            </div>
            {% if assignment.review_round.editorrevisionrequest %}
                <div class="card-footer">
                    <h3 id="author-cover-letter">Author cover letter</h3>
                    {% if assignment.review_round.editorrevisionrequest.cover_letter_file %}
                        <a href="{{ assignment.review_round.editorrevisionrequest.cover_letter_file.url }}">Cover letter</a><br>
                    {% endif %}
                    {% if assignment.review_round.editorrevisionrequest.author_note %}
                        {# FIXME: Content is not really safe, we must add a sanitizer (see https://pypi.org/project/html-sanitizer/) #}
                        {{ assignment.review_round.editorrevisionrequest.author_note|safe }}
                    {% endif %}
                </div>
            {% endif %}
        {% endwith %}
    {% endwith %}
    <div>
        {% for action in assignment_and_actions.actions %}
            <a class="btn {% if action.url == '#' %}btn-secondary{% else %}btn-primary{% endif %}"
               href="{{ action.url }}"
               {% if action.tooltip %}title="{{ action.tooltip }}"{% endif %}>
                {% if action.label %}
                    {{ action.label }}
                {% else %}
                    {{ action.name }}
                {% endif %}
            </a>
        {% endfor %}
    </div>
</div>
