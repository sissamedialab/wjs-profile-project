{% load wjs_review wjs_articles %}
{% with article=workflow.article attention_flag=workflow|article_requires_attention_tt:user %}
    <tr {% if attention_flag %}class="table-warning"{% endif %}>
        <td>
            <p>
                <a title="{{ article.title }}"
                   href="{% url 'wjs_article_details' workflow.id %}"
                   class="fw-bold">{{ article.id }}</a>
                <br />
                {{ article.date_submitted|date:"d-M" }}
                <br />
                {{ article.section.name }}
            </p>
        </td>
        <td>
            <p>
                <span title="State">{{ workflow.get_state_display }}</span>
                <br />
                <span title="Current version">Version {{ workflow.article.current_review_round }}</span>
                <br />
                <span title="last transition">{{ workflow.modified|date:"d-M" }}</span>
            </p>
            {% if attention_flag %}
                <p>
                    <span title="Needs attention"><strong>{{ attention_flag }}</strong></span>
                </p>
            {% endif %}
        </td>
        <td>
            {% include "wjs_review/corresponding_author.html" %}
        </td>
        <td>
            {% with editor_assignment_data=article|article_current_editor %}
                <p>
                    {{ editor_assignment_data.editor }}
                    <br />
                    <span title="assigned">{{ editor_assignment_data.days_elapsed }} days</span>
                </p>
            {% endwith %}
        </td>
        <td>
            {% if workflow.get_state_display == "Editor selected" %}
                {% include "wjs_review/elements/reviews_cell.html" %}
            {% endif %}
        </td>
        <td title="Issue (if available)">{{ article.primary_issue|default:"—" }}</td>
        <td title="latest EO note">
            {% last_user_note article=workflow.article user=request.user as note %}
            {% if note %}
                <div>
                    <a class="text-decoration-none"
                       data-bs-toggle="collapse"
                       href="#note-{{ workflow.article.id }}"
                       role="button"
                       aria-expanded="false"
                       aria-controls="note-{{ workflow.article.id }}">ℹ</a>
                    <span class="collapse personal-note" id="note-{{ workflow.article.id }}">
                        <strong>{{ note.subject }}</strong>
                        <div>{{ note.body }}</div>
                    </span>
                </div>
            {% endif %}
        </td>
    </tr>
{% endwith %}
