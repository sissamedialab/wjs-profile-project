{% load django_bootstrap5 wjs_review %}
{% url "wjs_select_reviewer" workflow.pk as wjs_select_reviewer %}
{% for user in users %}
    {% reviewer_btn_props user selected workflow as btn %}
    <tr>
        <td>.9</td>
        <td>
            {% if user.wjs_is_only_prophy %}
              <a href="{{ user.wjs_prophy_auth_url }}{{ user.author_id }}" title="Candidates's details (if available)">Prophy site {{ user.author_id }}</a> {{ user.full_name }}
            {% else %}
               <a href="#" title="Reviewer's details (if available)">{{ user.id }}</a> {{ user.full_name }}
            {% endif %}
        </td>
        <td>{{ user.email }}</td>
        <td>
            {% if user.wjs_is_author %}<span title="Author of the paper">üñÜ</span>{% endif %}
            {# TODO: user.is_active to be replaced by user.does_not_want_to_review_anything #}
            {% if not user.is_active %}<span title="Non-active user">üí§</span>{% endif %}
            {% if user.wjs_is_active_reviewer %}
                {% if user.wjs_has_declined_current_review_round %}
                    <span title="Declined this round">‚úó</span>
                {% elif user.wjs_has_currently_completed_review %}
                    <span title="Completed this round">‚úì</span>
                {% else %}
                    <span title="Active reviewer/already selected">‚èµ</span>
                {% endif %}
            {% else %}
                {# Show flags for previous rounds only if there is nothing for the current one. #}
                {% if user.wjs_is_past_reviewer %}
                    {% if user.wjs_has_delined_previous_review_round %}
                        <span title="Declined previous round">(‚úó)</span>
                    {% elif user.wjs_has_previously_completed_review %}
                        <span title="Completed previous round">(‚úì)</span>
                    {% else %}
                        <span title="Past reviewer (assignment not declined, but review never completed)">¬´</span>
                    {% endif %}
                {% endif %}
            {% endif %}
            {% if user == request.user %}<span title="Me">Me!</span>{% endif %}
            {% if user.wjs_is_prophy_candidate %}<span title="Prophy candidate for the paper">P</span>{% endif %}
        </td>
        <td>
            {% comment %}Tooltips for .disabled or disabled elements must be triggered on a wrapper element.{% endcomment %}
            {% if user.wjs_is_only_prophy %}
            <a href="{% url "wjs_invite_reviewer_prophy" pk=workflow.pk prophy_account_id=user.author_id %}" class="btn btn-primary">Invite</a>
            {% else %}
                  <span class="d-inline-block"
                  tabindex="0"
                  data-toggle="tooltip"
                  title="{{ btn.disabled_cause }}">{% bootstrap_button disabled=btn.disabled button_class=btn.css_class hx_vals=btn.value button_type="button" hx_trigger="click" hx_post=wjs_select_reviewer data_toggle=btn.disabled_cause content="Select" %}</span>
            {% endif %}
        </td>
    </tr>
{% endfor %}
