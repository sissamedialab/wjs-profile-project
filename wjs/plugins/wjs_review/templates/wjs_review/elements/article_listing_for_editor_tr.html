{% load wjs_review wjs_articles %}
{% with article=workflow.article attention_flag=workflow|article_requires_attention_tt:user %}
    <tr {% if attention_flag %}class="table-warning"{% endif %}>
        <td>{{ article.id }}</td>
        <td>
                {% include "wjs_review/corresponding_author.html" %}
        </td>
        <td>
            <a title="{{ article.title }}"
               href="{% url 'wjs_article_details' workflow.id %}"
               class="fw-bold">{{ article.title|truncatewords:6 }}</a>
        </td>
        <td>{{ article.section.name }}</td>
        <td title="Issue (if available)">{{ article.primary_issue|default:"â€”" }}</td>
        <td>
            <span title="State">State: "{{ workflow.get_state_display }}"</span> (<span title="last transition">{{ workflow.modified|date:"d-M" }}</span>)
            {% if attention_flag %}
                <br />
                <span title="Needs attention"><strong>{{ attention_flag }}</strong></span>
            {% endif %}
        </td>
        <td>
            {% if workflow.get_state_display == "Editor selected" %}
                {% include "wjs_review/elements/reviews_cell.html" %}
            {% endif %}
        </td>
        <td title="latest personal note">
            {% last_user_note article=workflow.article user=user as note %}
            {% if note %}
                <div>
                    <a class="text-decoration-none"
                       data-bs-toggle="collapse"
                       href="#note-{{ workflow.article.id }}"
                       role="button"
                       aria-expanded="false"
                       aria-controls="note-{{ workflow.article.id }}">â„¹</a>
                    {% comment %} I'd prefer to use a div with class="d-inline", but d-inline and collapse don't go along nicely and d-inline breaks the collapsing. ðŸ˜¢ {% endcomment %}
                    <span class="collapse personal-note" id="note-{{ workflow.article.id }}">
                        <strong>{{ note.subject }}</strong>
                        <div>{{ note.body }}</div>
                    </span>
                </div>
            {% endif %}
        </td>
    </tr>
{% endwith %}
