{% load django_bootstrap5 i18n %}

<div class="row">
    <div class="col">
        <h2>{% translate "General Review Guidelines" %}</h2>
    </div>
</div>
<div class="row">
    <div class="col">
        {{ journal_settings.general.reviewer_guidelines|safe }}
    </div>
</div>
<div class="row">
    <div class="col">
        <h2>{% translate "Information for this Form" %}</h2>
    </div>
</div>
<div class="row">
    <div class="col">
        {{ assignment.form.intro|safe }}
    </div>
</div>
<form action="{{ request.path }}{% if access_code %}?access_code={{ access_code }}{% endif %}" method="post" enctype="multipart/form-data">
    {% csrf_token %}
    <div class="row">
        <div class="col">
            {% if form.errors %}
                <div class="alert alert-info">
                {% translate "Please correct errors below. Note, you'll have to reselect any files you want uploaded." %}
                </div>
            {% endif %}
            {% bootstrap_form form required_css_class="required-field" %}
        </div>
    </div>
    <div class="row">
        {% if allow_draft %}
            <div class="col">
                {% translate "Save as draft" as draft_label %}
                {% bootstrap_button button_type="submit" name="submit_report" value=0 content="Save as draft" %}
            </div>
        {% endif %}
        <div class="col">
            {% translate "Submit" as submit_label %}
            {% bootstrap_button button_type="submit" name="submit_report" value=1 content=submit_label %}
        </div>
    </div>
</form>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const recommendationField = document.querySelector('#id_recommendation');
    const followUpField = document.querySelector('#id_follow_up_action');
    const suggestedReviewersField = document.querySelector('#id_suggested_reviewers');

    function updateFormVisibility() {
        const recommendationValue = recommendationField.value;

        if (recommendationValue === 'revise_minor' || recommendationValue === 'revise_major') {
            followUpField.style.display = 'block';
            followUpField.parentElement.querySelector("label").style.display = 'block'
        }
        else {
            followUpField.style.display = 'none';
            followUpField.parentElement.querySelector("label").style.display = 'none'
            followUpField.value = '';
        }

        if (followUpField.value === 'another_reviewer') {
            suggestedReviewersField.style.display = 'block';
            suggestedReviewersField.parentElement.querySelector("label").style.display = 'block'
        }
        else {
            suggestedReviewersField.style.display = 'none';
            suggestedReviewersField.parentElement.querySelector("label").style.display = 'none'
        }
    }
    updateFormVisibility();
    if (recommendationField) {
        recommendationField.addEventListener('change', updateFormVisibility);
    }
    if (followUpField) {
        followUpField.addEventListener('change', updateFormVisibility);
    }
});
</script>
