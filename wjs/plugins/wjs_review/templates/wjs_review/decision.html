{% extends "wjs_review/base.html" %}
{% load django_bootstrap5 i18n %}
{% load wjs_review %}
{% block title %}
      {% translate "Take a decision" %}
{% endblock title %}
{% block content_header %}
    {% include "wjs_review/elements/article_title_and_authors.html" %}
{% endblock content_header %}
{% block content %}
  <div class="container">
    <form name="decision" method="post">
      {% if not hide_reviews %}
      <div class="row">
        <div class="col-sm-12 border-bottom border-2">
          <div class="card border border-1">
            <div class="card-head"><h2>{% translate "Reviews" %}</h2></div>
            <div class="card-body">
              <ul>
                <h3>{% translate "Declined" %}</h3>
                {% for review in declined_reviews %}
                  <li>{{ review }}</li>
                {% endfor %}
              </ul>
              <ul>
                <h3>{% translate "Submitted" %}</h3>
                {% for review in submitted_reviews %}
                  <li>
                    {# TODO: Make fields editable and allow to select visible to author flag #}
                    {{ review }}<br>
                    {% for element in review.reviewassignmentanswer_set.all %}
                      {{ element.original_element.name }}: {{ element.answer|safe }}
                    {% endfor %}
                  </li>
                {% endfor %}
              </ul>
              <ul>
                <h3>{% translate "Open" %}</h3>
                {% for review in open_reviews %}
                  <li>{{ review }}</li>
                {% endfor %}
              </ul>
            </div>
          </div>
        </div>
      </div>
      {% endif %}
      <div class="row">
        <div class="col-sm-12 border-bottom border-2">
          <div class="card border border-1">
            <div class="card-head">{% translate "Decisions" %}</div>
            <div class="card-body">
              {% get_available_transitions workflow as transitions %}
              {% csrf_token %}
              {% bootstrap_form_errors form layout='inline' %}
              {% if form.hide_decision %}
                {% bootstrap_field form.decision wrapper_class="visually-hidden" %}
              {% else %}
                {% bootstrap_field form.decision %}
              {% endif %}
              {% if form.hide_date_due %}
                {% bootstrap_field form.date_due wrapper_class="visually-hidden date-due" %}
              {% else %}
                {% bootstrap_field form.date_due wrapper_class="date-due" %}
              {% endif %}
              {% if form.decision_editor_report %}{% bootstrap_field form.decision_editor_report %}{% endif %}
              {% bootstrap_field form.decision_internal_note %}
              {% if form.withdraw_notice %}{% bootstrap_field form.withdraw_notice %}{% endif %}
            </div>
          </div>
        </div>
      </div>
      {% bootstrap_button button_type="submit" name="submit" value=1 content="Confirm" %}

    </form>
  </div>
  <script>
    function checkDateVisibility(decision)
    {
      if(["minor_revisions", "major_revisions", "tech_revisions"].indexOf(decision.selectedOptions[0].value) > -1) {
        document.querySelector('.date-due').classList.remove('visually-hidden')
      } else {
        document.querySelector('.date-due').classList.add('visually-hidden')
      }
    }

    (function () {
      'use strict'
      const decision = document.querySelector('#id_decision')

      decision.addEventListener('change', function () {
          checkDateVisibility(decision)
      })

      checkDateVisibility(decision)

})()
    </script>
{% endblock content %}
