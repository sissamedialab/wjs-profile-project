{% load django_bootstrap5 humanize static wjs_permissions wjs_review %}
{% get_review_assignment_actions assignment as actions %}
{% url "wjs_message_write" article_id=article.pk recipient_id=assignment.reviewer.pk as add_message %}
{% translate "Send message" as send_message_label %}
<!-- djlint:off -->
{% translate "Write a message <i class=\"bi bi-chat-square-text\"></i>" as write_message_label %}
<!-- djlint:on -->
<div class="accordion-item {% if assignment.attention_condition %}{{ assignment.attention_condition.style }}{% endif %}">
  <h2 class="accordion-header" id="heading-review-assignment-{{ assignment.pk }}">
    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-review-assignment-{{ assignment.pk }}" aria-expanded="{% if selected %}true{% endif %}" aria-controls="collapse-review-assignment-{{ assignment.pk }}">
      <span><b>{{ assignment.reviewer.get_full_name }}</b> {% if assignment.attention_condition %}[{{ assignment.attention_condition.message }}]{% endif %}</span>
      {% if assignment.attention_condition %}{{ assignment.attention_condition.icon }}{% endif %}
    </button>
  </h2>
  <div id="collapse-review-assignment-{{ assignment.pk }}" class="accordion-collapse collapse{% if selected %} show{% endif %}" aria-labelledby="heading-review-assignment-{{ assignment.pk }}" data-bs-parent="#metadata">
    <div class="accordion-body">
      {% if assignment.date_declined %}
        <p>{% translate "Assignment date" %}: {{ assignment.date_requested|date:DATE_FORMAT }}</p>
        <p>{% translate "Decline date" %}: {{ assignment.date_declined|date:DATE_FORMAT }}</p>
      {% elif not assignment.date_accepted %}
        <p>{% translate "Accept/decline due date" %}: {{ assignment.date_due|date:DATE_FORMAT }}</p>
      {% elif assignment.date_complete %}
        <p>{% translate "Assignment date" %}: {{ assignment.date_requested|date:DATE_FORMAT }}</p>
        <p>{% translate "Acceptance date" %}: {{ assignment.date_accepted|date:DATE_FORMAT }}</p>
        <p>{% translate "Review date" %}: {{ assignment.date_complete|date:DATE_FORMAT }}</p>
      {% else %}
        <p>{% translate "Assignment date" %}: {{ assignment.date_requested|date:DATE_FORMAT }}</p>
        <p>{% translate "Acceptance date" %}: {{ assignment.date_accepted|date:DATE_FORMAT }}</p>
      {% endif %}
      {% for reminder in assignment.unsent_reminders %}
        <p>{{ forloop.counter|ordinal }} {% translate "reminder to reviewer" %}: {% translate "will be sent on" %} {{ reminder.date_due|date:DATE_FORMAT }}</p>
      {% endfor %}
      <div class="d-flex flex-wrap gap-2">
        {% for action in actions %}
          {% include "wjs_review/details/elements/actions_button.html" with is_button=True %}
        {% endfor %}
        {% bootstrap_button content=write_message_label href=add_message title=send_message_label button_class="btn-secondary" %}
        {% hijack_button user=assignment.reviewer size="medium" %}
      </div>
    </div>
  </div>
</div>
