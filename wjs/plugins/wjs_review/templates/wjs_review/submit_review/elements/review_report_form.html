{% load django_bootstrap5 i18n %}
{% translate "If you do, please write do the Editor in charge" as conflict_interest_label %}
{% translate "Please wither write your comments in the text area and/or upload a file" as author_review_label %}
<form action="{{ request.path }}{% if access_code %}?access_code={{ access_code }}{% endif %}" method="post" enctype="multipart/form-data">
    {% csrf_token %}
    <div class="col">
        {% bootstrap_form_errors form type='fields' %}
        {# FIXME: We might want to refactor this implementation if we find a way to express this structure with django-bootstrap4 #}
        <div class="mb-3">
            <label class="fw-bold" for="{{ form.conflict_of_interest.id_for_label }}">
                {{ form.conflict_of_interest.label }}
            </label>
            <div>{{ conflict_interest_label }}</div>
            {% for radio in form.conflict_of_interest %}
                <div class="form-check-inline">
                    {{ radio.tag }}
                    <label class="form-check-label" for="{{ radio.id_for_label }}">
                        {{ radio.choice_label }}
                    </label>
                </div>
            {% endfor %}
        </div>
        <div class="mb-3">
            {% bootstrap_form form required_css_class="required-field" exclude='conflict_of_interest, author_review, review_file, author_file_title' %}
            {% bootstrap_field form.author_review label_class="fw-bold" addon_before=author_review_label addon_before_class=None %}
            {% bootstrap_field form.review_file label_class="fw-bold" %}
            {% bootstrap_field form.author_file_title %}
        </div>
    </div>
    <div class="row">
        {% if allow_draft %}
            <div class="col">
                {% translate "Save as draft" as draft_label %}
                {% bootstrap_button button_type="submit" name="submit_report" value=0 content="Save as draft" %}
            </div>
        {% endif %}
        <div class="col">
            {% translate "Submit" as submit_label %}
            {% bootstrap_button button_type="submit" name="submit_report" value=1 content=submit_label %}
        </div>
    </div>
</form>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const recommendationField = document.querySelector('#id_recommendation');
    const followUpField = document.querySelector('#id_follow_up_action');
    const suggestedReviewersField = document.querySelector('#id_suggested_reviewers');

    function updateFormVisibility() {
        const recommendationValue = recommendationField.value;

        if (recommendationValue === 'revise_minor' || recommendationValue === 'revise_major') {
            followUpField.style.display = 'block';
            followUpField.parentElement.querySelector("label").style.display = 'block'
        }
        else {
            followUpField.style.display = 'none';
            followUpField.parentElement.querySelector("label").style.display = 'none'
            followUpField.value = '';
        }

        if (followUpField.value === 'another_reviewer') {
            suggestedReviewersField.style.display = 'block';
            suggestedReviewersField.parentElement.querySelector("label").style.display = 'block'
        }
        else {
            suggestedReviewersField.style.display = 'none';
            suggestedReviewersField.parentElement.querySelector("label").style.display = 'none'
        }
    }
    updateFormVisibility();
    if (recommendationField) {
        recommendationField.addEventListener('change', updateFormVisibility);
    }
    if (followUpField) {
        followUpField.addEventListener('change', updateFormVisibility);
    }
});
</script>
